function Esame(t,e,a,i,n){this.materia=t,this.crediti=e,this.data=a,this.voto=i,this.sostenuto=n}function init(){trovaAttDidattiche(),riempiEsami(),calcolaMedia(),aggiornaEsamiSenzaVoto(),ordinaEsami(),riempiArrayDaEsami(),inserisciDati(),salva(),console.log(esami)}function trovaAttDidattiche(){$(tabella).children("tr").each(function(){attValida($(this))&&nodiEsami.push(this)})}function attValida(t){return isNaN(t.find("td:nth-child(1)").text()+".")?!1:!0}function loadLib(){var t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment-with-locales.min.js",document.head.appendChild(t);var e=document.createElement("script");e.src="https://cdn.rawgit.com/SheetJS/js-xlsx/master/dist/xlsx.core.min.js",document.head.appendChild(e);var a=document.createElement("script");a.src="https://cdn.rawgit.com/eligrey/Blob.js/master/Blob.js",document.head.appendChild(a);var i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js",document.head.appendChild(i)}function esameFatto(t){return testo=t.find("td:nth-child(10)").text(),""===testo?!1:!0}function esameConVoto(t){var e="a";return testo=t.find("td:nth-child(10)").text(),e=/[^-]+/.exec(testo),isNaN(e)||null===e?"30L "===e.toString()?!0:!1:!0}function riempiEsami(){for(var t=0;t<nodiEsami.length;t++)esami[t]=creaEsame($(nodiEsami[t]))}function ordinaEsami(){for(var t=0;t<esami.length;t++)esami[t].sostenuto||attDaSostenere.push(esami[t])}function creaEsame(t){var e,a,i="",n=0,o=0;return i=materiaDaNodo(t),n=parseInt(t.find("td:nth-child(7)").text()),esameFatto(t)?(o=esameConVoto(t)?parseInt(votoDaNodo(t)):0,a=!0,e=dataDaNodo(t)):a=!1,new Esame(i,n,new Date(moment(e,"DD-MM-YYYY")),o,a)}function materiaDaNodo(t){return testo=t.find("td:nth-child(2)").text(),testo.substring(9).toString()}function votoDaNodo(t){var e,a=t.find("td:nth-child(10)").text();return e=/[^-]+/.exec(a).toString(),"30L "===e?31:e}function dataDaNodo(t){return testo=t.find("td:nth-child(10)").text(),testo.slice(-10).toString()}function calcolaMedia(){for(var t=0,e=0,a=0;a<esami.length;a++)esami[a].sostenuto&&esami[a].voto>0&&(t+=esami[a].voto*esami[a].crediti,e+=esami[a].crediti);media=t/e}function aggiornaEsamiSenzaVoto(){for(var t=0;t<esami.length;t++)esami[t].sostenuto&&0===esami[t].voto&&(esami[t].voto=Math.ceil(media))}function waitForElement(){"undefined"!=typeof moment&&"undefined"!=typeof XLSX?init():(console.log("caricamento..."),setTimeout(function(){waitForElement()},250))}function Workbook(){return this instanceof Workbook?(this.SheetNames=[],void(this.Sheets={})):new Workbook}function riempiArrayDaEsami(){for(var t=0;t<esami.length;t++)esami[t].sostenuto&&arrayEsami.push(estraiValoriDaArray(esami[t]));for(var t=0;t<attDaSostenere.length;t++)arrayEsami.push(estraiValoriDaArray(attDaSostenere[t]))}function estraiValoriDaArray(t){return Object.keys(t).map(function(e){return t[e]})}function inserisciDati(){data[0]=Object.getOwnPropertyNames(esami[0]);for(var t=0;t<arrayEsami.length;t++)data[t+1]=arrayEsami[t]}function salva(){function t(){return this instanceof t?(this.SheetNames=[],void(this.Sheets={})):new t}function e(t,e){e&&(t+=1462);var a=Date.parse(t);return(a-new Date(Date.UTC(1899,11,30)))/864e5}function a(t){for(var a={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0;n!=t.length;++n)for(var o=0;o!=t[n].length;++o){i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);var r={v:t[n][o]};if(null!=r.v){var s=XLSX.utils.encode_cell({c:o,r:n});"number"==typeof r.v?r.t="n":"boolean"==typeof r.v?r.t="b":r.v instanceof Date?(r.t="n",r.z=XLSX.SSF._table[14],r.v=e(r.v)):r.t="s",a[s]=r}}return i.s.c<1e7&&(a["!ref"]=XLSX.utils.encode_range(i)),a}function i(t){for(var e=new ArrayBuffer(t.length),a=new Uint8Array(e),i=0;i!=t.length;++i)a[i]=255&t.charCodeAt(i);return e}var n="Esse3",o=new t,r=a(data);o.SheetNames.push(n),o.Sheets[n]=r;var s={bookType:"xlsx",bookSST:!1,type:"binary"},c=XLSX.write(o,s);saveAs(new Blob([i(c)],{type:""}),"esami.xlsx")}var tabella=$("tr>td>table>tbody:contains(Attivit√† Didattiche)"),nodiEsami=[],nodiAtt=[],esami=[],arrayEsami=[],data=[],attDaSostenere=[],media=0;loadLib(),waitForElement();
